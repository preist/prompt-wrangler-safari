(function(){"use strict";console.log("[Prompt Wrangler] Content script (isolated world) loaded"),(async()=>{try{const e=await chrome.storage.local.get(["settings.dataTypes","settings.protectedMode","allowlist"]);e["settings.dataTypes"]&&(window.dispatchEvent(new CustomEvent("prompt-wrangler-data-types-change",{detail:{dataTypes:e["settings.dataTypes"]}})),console.log("[Prompt Wrangler] Sent initial data types to injected script")),e["settings.protectedMode"]!==void 0&&(window.dispatchEvent(new CustomEvent("prompt-wrangler-mode-change",{detail:{enabled:e["settings.protectedMode"]}})),console.log("[Prompt Wrangler] Sent initial protected mode to injected script")),e.allowlist&&(window.dispatchEvent(new CustomEvent("prompt-wrangler-allowlist-change",{detail:{allowlist:e.allowlist}})),console.log("[Prompt Wrangler] Sent initial allowlist to injected script"))}catch(e){console.error("[Prompt Wrangler] Failed to load initial settings:",e)}})(),window.addEventListener("prompt-wrangler-issues",e=>{const o=e,{issues:t}=o.detail;console.log("[Prompt Wrangler] Received issues from injected script:",t),(async()=>{try{const n={type:"ISSUES_DETECTED",issues:t};await chrome.runtime.sendMessage(n),console.log("[Prompt Wrangler] Sent issues to service worker")}catch(n){console.error("[Prompt Wrangler] Error sending issues to service worker:",n)}})()}),chrome.runtime.onMessage.addListener((e,o,t)=>{e.type==="TOGGLE_PROTECTED_MODE"&&(console.log("[Prompt Wrangler] Protected mode toggled:",e.enabled),window.dispatchEvent(new CustomEvent("prompt-wrangler-mode-change",{detail:{enabled:e.enabled}}))),e.type==="UPDATE_DATA_TYPES"&&(console.log("[Prompt Wrangler] Data types updated:",e.dataTypes),window.dispatchEvent(new CustomEvent("prompt-wrangler-data-types-change",{detail:{dataTypes:e.dataTypes}})))}),chrome.storage.onChanged.addListener((e,o)=>{if(o==="local"&&e.allowlist){const t=e.allowlist.newValue;window.dispatchEvent(new CustomEvent("prompt-wrangler-allowlist-change",{detail:{allowlist:t??[]}})),console.log("[Prompt Wrangler] Allowlist changed, notified injected script")}})})();
