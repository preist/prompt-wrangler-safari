(function(){"use strict";async function i(){try{const t=(await chrome.storage.local.get(["settings.protectedMode"]))["settings.protectedMode"],e={16:t===!1?"icons/icon-16-off.png":"icons/icon-16.png",32:t===!1?"icons/icon-32-off.png":"icons/icon-32.png"};await chrome.action.setIcon({path:e}),console.log("[Prompt Wrangler] Icon updated:",e)}catch(o){console.error("[Prompt Wrangler] Failed to update icon:",o)}}chrome.storage.onChanged.addListener((o,t)=>{t==="local"&&o["settings.protectedMode"]&&i()}),i(),chrome.runtime.onMessage.addListener((o,t,e)=>(o.type==="ISSUES_DETECTED"&&(console.log("[Prompt Wrangler] Background received issues:",o.issues),(async()=>{try{const r=Date.now(),a=Math.random().toString(36).substring(2,9),c=`batch-${r.toString()}-${a}`,l=o.issues.map(n=>({...n,batchId:c})),d=(await chrome.storage.local.get(["issues.history"]))["issues.history"]??[],g=[...l,...d];await chrome.storage.local.set({"issues.latestBatch":c,"issues.history":g}),console.log("[Prompt Wrangler] Stored issues in chrome.storage");const s=o.issues.length;await chrome.action.setBadgeText({text:s.toString()}),await chrome.action.setBadgeBackgroundColor({color:"#DC2626"});const p=s===1?"item":"items";try{await chrome.notifications.create("prompt-wrangler-alert",{type:"basic",iconUrl:"icons/icon-128.png",title:"Sensitive Data Detected",message:`${s.toString()} ${p} detected and anonymized`,priority:2}),console.log("[Prompt Wrangler] Notification created successfully")}catch(n){console.error("[Prompt Wrangler] Failed to create notification:",n)}chrome.runtime.sendMessage({type:"NEW_ISSUES",issues:o.issues},()=>{chrome.runtime.lastError&&console.log("[Prompt Wrangler] Popup not open, issues stored for later")})}catch(r){console.error("[Prompt Wrangler] Failed to store issues:",r)}})()),!1)),chrome.notifications.onClicked.addListener(o=>{o==="prompt-wrangler-alert"&&(chrome.action.openPopup(),console.log("[Prompt Wrangler] Notification clicked, opening popup"))})})();
